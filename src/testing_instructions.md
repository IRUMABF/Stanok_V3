# Інструкція по тестуванню логіки роботи Stanok V3

## Проблема, яку ми виправили

**Раніше**: Машина завжди залишалася в статусі "STOPPED" і не виконувала команди, навіть при натисканні кнопок START/STOP.

**Причина**: У коді були коментарі `// ...single block логіка...` та `// ...автоматичний режим...`, але реальна логіка виконання команд була відсутня.

## Що тепер працює

### 1. **Single Block режим** (кнопка SINGLE BLOCK)
- Увімкнути: натиснути SINGLE BLOCK кнопку
- Виконати команду: натиснути START кнопку
- Кожне натискання START виконує наступну команду
- Після всіх команд режим автоматично вимикається

### 2. **Автоматичний режим** (кнопка START)
- Запустити: натиснути START кнопку
- Машина автоматично виконує всі команди послідовно
- Після завершення цикл перезапускається

### 3. **Пауза** (кнопка STOP)
- Зупинити: натиснути STOP кнопку
- Машина зупиняється і чекає на START

## Як тестувати

### Крок 1: Завантажте основний код
```cpp
// src/main.cpp - основний файл з усіма командами
```

### Крок 2: Відкрийте Serial Monitor
- Швидкість: 9600 baud
- Ви побачите статус оновлення кожні 4 секунди

### Крок 3: Тестуйте Single Block режим
1. **Натисніть SINGLE BLOCK** - режим увімкнеться
2. **Натисніть START** - виконається команда 1 (SPICE OUT)
3. **Натисніть START** - виконається команда 2 (PAINT VALVE OPEN)
4. **Продовжуйте** - всі команди виконаються по черзі

### Крок 4: Тестуйте автоматичний режим
1. **Натисніть START** (без SINGLE BLOCK) - запуститься автоматичний режим
2. **Спостерігайте** - команди виконуються автоматично
3. **Натисніть STOP** - машина зупиниться

## Що ви побачите в терміналі

### При увімкненні Single Block:
```
=== SINGLE BLOCK BUTTON PRESSED ===
Single block mode: ENABLED
Current step reset to 0
Press START to execute next step
Press STOP to pause execution
```

### При виконанні команди:
```
=== START BUTTON (SINGLE BLOCK) ===
Executing test command: 1
=== EXECUTING: SPICE OUT ===
Sensor 3 (Spice shift) status: INACTIVE - Not ready
Activating spice dispense valve for 2 seconds...
Spice out operation completed
===============================
Step completed. Next step: 1
```

### Статус оновлення:
```
=== STATUS UPDATE ===
Machine Status: STOPPED
Operating Mode: SINGLE BLOCK
Dispense Mode: SINGLE JAR
Current Step: 1/28
Next Command: PAINT VALVE OPEN
Conveyor Status: STOPPED
Conveyor Dociag: INACTIVE
```

## Тестовий скетч

Якщо основна логіка не працює, використовуйте простий тестовий скетч:

```cpp
// src/test_machine_logic.ino - спрощений тест
```

Цей скетч має тільки 3 тестові команди і простішу логіку для діагностики.

## Діагностика проблем

### Машина не реагує на кнопки:
1. Перевірте підключення кнопок
2. Перевірте чи викликається `controls.update()` в `loop()`
3. Перевірте Serial Monitor на наявність помилок

### Команди не виконуються:
1. Перевірте чи правильно створений масив `machineProgram[]`
2. Перевірте чи всі функції команд існують
3. Перевірте чи `currentStep` не перевищує `machineProgramLength`

### Статус завжди "STOPPED":
1. Перевірте логіку в `loop()` після обробки кнопок
2. Перевірте чи правильно встановлюються змінні `machineRunning` та `machinePaused`
3. Перевірте умови в блоках `if (!machinePaused)`

## Очікувана поведінка

### Single Block режим:
- ✅ Кнопка SINGLE BLOCK перемикає режим
- ✅ START виконує по одній команді
- ✅ Показує поточний крок
- ✅ Автоматично вимикається після всіх команд

### Автоматичний режим:
- ✅ START запускає автоматичне виконання
- ✅ Команди виконуються послідовно
- ✅ Цикл перезапускається
- ✅ STOP зупиняє виконання

### Відладка:
- ✅ Статус оновлюється кожні 4 секунди
- ✅ Показує поточний крок та наступну команду
- ✅ Показує стан всіх кнопок та датчиків

## Наступні кроки

1. **Протестуйте основну логіку** з `main.cpp`
2. **Якщо є проблеми** - використовуйте `test_machine_logic.ino`
3. **Додайте реальну логіку** в команди (замість коментарів)
4. **Налаштуйте таймери** та затримки між командами 