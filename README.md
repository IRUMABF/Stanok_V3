# Stanok_V3

Цей репозиторій містить прошивку для автоматизованої лінії фасування та пакування баночок з фарбою на базі Arduino (RAMPS 1.4).

---

## Структура проекту

- **src/** — основний код прошивки:
  - [`main.cpp`](src/main.cpp) — головний файл програми, реалізує основну логіку роботи, містить структуру виконання команд та приклади використання всіх класів.
  - [`pinout.h`](src/pinout.h) — всі призначення пінів для підключення електроніки: пневмоклапани, мотори, датчики, кнопки, світлодіоди.
  - [`config.h`](src/config.h) — основні налаштування станка: параметри конвеєра, швидкість, кількість баночок у збірці, кінематика, режими роботи.
  - [`pnevmatik_time.h`](src/pnevmatik_time.h) — часи роботи пневматичних циліндрів (затримки, утримання) для кожної операції.
  - [`pneumatic_valve.h`](src/pneumatic_valve.h) — клас для керування пневматичними клапанами з підтримкою таймерів.
  - [`controls.h`](src/controls.h) — обробка кнопок та датчиків, debounce, події натискання.
  - [`conveyor.h`](src/conveyor.h) — клас для керування конвеєром (два крокові мотори, рух, дотягування, зупинка).
  - [`algoritm.md`](src/algoritm.md) — текстовий опис алгоритму роботи станка, логіка роботи датчиків, режими, особливості.

- **include/**, **lib/** — для додаткових бібліотек та заголовків (можна використовувати для розширення функціоналу).
- **old code/** — попередні версії коду для референсу.
- **test/** — тести (поки порожньо).

---

## Де і які налаштування шукати

### Основні налаштування станка

- [`src/config.h`](src/config.h)
  - **Параметри конвеєра**: крок ременя, кількість зубів на шківі, мікрокрок, кроки на оберт, швидкість руху.
  - **Кінематика**: розрахунок кроків на мм, швидкість, інтервали імпульсів.
  - **Напрямки моторів**: `MOTOR_X_DIR`, `MOTOR_Y_DIR`.
  - **Інтервал опитування датчиків**: `SENSOR_POLL_INTERVAL`.
  - **Зсув баночки після датчика**: `JAR_CENTERING_MM`.
  - **Кількість баночок у збірці**: `JARS_IN_SET`.

### Призначення пінів

- [`src/pinout.h`](src/pinout.h)
  - **Пневмоклапани**: `PNEUMATIC_1_PIN` ... `PNEUMATIC_5_PIN` — активні на цьому контролері; інші перенесено/видалено.
  - **Мотори конвеєра**: `X_STEP_PIN`, `X_DIR_PIN`, `X_ENABLE_PIN`, `Y_STEP_PIN`, `Y_DIR_PIN`, `Y_ENABLE_PIN`.
  - **Датчики**: `sensor_1`, `sensor_2` — положення баночок.
  - **Кнопки**: `start_PIN`, `stop_PIN`, `modeButtonPin`, `singleblockButtonPin`.
  - **Світлодіоди**: `ledMode0Pin`, `ledMode1Pin`, `LED_PIN`.
 

### Часи роботи пневматики

-- [`src/pnevmatik_time.h`](src/pnevmatik_time.h)
  - Для кожної операції (наприклад, видача спайок, рух поршня, закриття кришок, зсування, платформа, запайка, охолодження) задані три параметри:
    - `*_OPEN_TIME` — час відкривання/руху (мс)
    - `*_HOLD_TIME` — час утримання (мс)
    - `*_DELAY` — затримка після операції (мс)
  - Змінюйте ці значення для налаштування швидкості та послідовності роботи пневматики.

### Алгоритм роботи та логіка

- [`src/algoritm.md`](src/algoritm.md)
  - Покроково описано повний цикл роботи станка, взаємодію пневматики, конвеєра, датчиків, кнопок.
  - Описано режими роботи (розлив у всі баночки або лише в першу), логіку реагування на датчики, особливості реалізації (без використання delay, робота кнопок, single block режим, керування вакуумом).

---

## Як зібрати та завантажити

1. Встановіть [PlatformIO](https://platformio.org/) (рекомендовано як розширення для VS Code).
2. Відкрийте цю папку як проект PlatformIO.
3. Відредагуйте `platformio.ini` за потреби (тип плати, порт тощо).
4. Для компіляції та завантаження прошивки використовуйте кнопки PlatformIO (`Build`, `Upload`) 
---

## Як змінити алгоритм або логіку

- Алгоритм роботи описаний у [`src/algoritm.md`](src/algoritm.md).
- Логіка виконання кроків реалізується у [`src/main.cpp`](src/main.cpp) через масив команд та відповідні функції.
- Для зміни послідовності або додавання нових операцій — редагуйте масив команд та відповідні функції у `main.cpp`.

---

## Керування та режими

- **Кнопки**:
  - `start_PIN` — запуск станка.
  - `stop_PIN` — зупинка станка (таймери зупиняються, стан зберігається).
  - `modeButtonPin` — перемикання режиму розливу (всі баночки або лише перша).
  - `singleblockButtonPin` — режим виконання по одній операції (для відладки).
- **Датчики**:
  - `sensor_1` — баночка під соплом.
  - `sensor_2` — баночка під пресом.
 
---

**Автор:**  
[Богдан Фіцак]
